{% extends 'base.html' %}
{% block content %}

<div style="padding-top: 40px; direction: rtl;">

    <div style="display: flex; justify-content: flex-start; gap: 12px; margin-bottom: 25px;">
        {% if user.worker.role == 'ADMIN' %}
            <a href="{% url 'add_task' %}" style="text-decoration: none; background: #316dca; color: white; padding: 10px 22px; border-radius: 8px; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: 0.2s;">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
                משימה חדשה
            </a>
            <a href="{% url 'add_team' %}" style="text-decoration: none; color: #adbac7; border: 1px solid #444c56; padding: 10px 22px; border-radius: 8px; font-size: 14px; background: #22272e; display: flex; align-items: center; gap: 8px; transition: 0.2s;">
                 הוספת צוות
            </a>
        {% endif %}
    </div>

    <div style="margin-bottom: 35px; background: #1c2128; border: 1px solid #444c56; border-radius: 12px; padding: 15px 20px;">
        <form method="get" action="{% url 'all_tasks' %}" style="display: flex; align-items: center; gap: 15px; width: 100%;">
            <div style="flex: 1; position: relative;">
                <select name="worker_filter" style="width: 100%; background: #22272e; color: #adbac7; border: 1px solid #444c56; padding: 10px 12px; border-radius: 8px; font-size: 14px; outline: none; cursor: pointer; appearance: none;">
                    <option value="all">כל העובדים</option>
                    {% for worker in workers %}
                        <option value="{{worker.id}}" {% if request.GET.worker_filter == worker.id|stringformat:"i" %} selected {% endif %}>{{worker.user.username}}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="flex: 1; position: relative;">
                <select name="status_filter" style="width: 100%; background: #22272e; color: #adbac7; border: 1px solid #444c56; padding: 10px 12px; border-radius: 8px; font-size: 14px; outline: none; cursor: pointer; appearance: none;">
                    <option value="all">כל הסטטוסים</option>
                    {% for value,label in status_choices %}
                        <option value="{{value}}" {% if request.GET.status_filter == value %}selected{% endif %}>{{label}}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit" style="width: 130px; height: 40px; background: #316dca; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; margin: 0px;">סנן תוצאות</button>
            <a href="{% url 'all_tasks' %}" style="height: 40px; width: 45px; background: #22272e; border: 1px solid #444c56; border-radius: 8px; color: #768390; display: flex; align-items: center; justify-content: center;" title="נקה הכל">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
            </a>
        </form>
    </div>

    <div style="display: flex; flex-direction: column; gap: 15px; width: 100%;">
        {% for task in tasks %}
        <div class="task-card" style="background: #22272e; border: 1px solid #444c56; padding: 18px 25px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; transition: 0.2s;">

            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="width: 12px; height: 12px; border-radius: 50%; background: {% if task.status == 'NEW' %}#768390 {% elif task.status == 'ACTIVE' %}#316dca{% else %}#347d39{% endif %};"></div>
                <div style="text-align: right;">
                    <h3 style="margin: 0; font-size: 18px; color: #adbac7; font-weight: 600;">{{task.name}}</h3>
                    <p style="color: #768390; font-size: 13px; margin: 4px 0 0 0;">{{task.description|truncatechars:85}}</p>
                    <p>{{task.status}}</p>
                </div>
            </div>

            <div style="display: flex; align-items: center; gap: 12px;">
                {% if task.status == 'NEW'  %}
                    <a href="{% url 'update_status_task' task.id %}" style="text-decoration: none; border: 1px solid #347d39; color: #347d39; font-size: 12px; font-weight: 600; padding: 6px 16px; border-radius: 6px; transition: 0.2s;" onmouseover="this.style.background='#347d39'; this.style.color='white';">שייך אלי</a>
                {% endif %}

                {% if task.status == 'ACTIVE' %}
                    {% if task.operator and task.operator.user == user and task.operator.user == user %}
                        <a href="{% url 'update_status_task' task.id %}" style="text-decoration: none; border: 1px solid #347d39; color: #347d39; font-size: 12px; font-weight: 600; padding: 6px 16px; border-radius: 6px; transition: 0.2s;" onmouseover="this.style.background='#347d39'; this.style.color='white';">סיום משימה</a>
                    {% endif %}
                {% endif %}

                {% if user.worker.role == 'ADMIN' %}
                <div style="display: flex; gap: 8px; border-right: 1px solid #444c56; padding-right: 12px;">
                    <a href="{% url 'update_task' task.id %}" class="action-icon" style="color: #768390;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4L18.5 2.5z"></path></svg>
                    </a>
                    <a href="{% url 'delete_task' task.id %}" class="action-icon" style="color: #e5534b;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div style="text-align: center; padding: 80px; color: #768390; border: 2px dashed #444c56; border-radius: 12px;">אין משימות להצגה.</div>
        {% endfor %}
    </div>
</div>

<style>
    body { background-color: #0d1117; font-family: 'Segoe UI', sans-serif; }
    .task-card:hover { border-color: #316dca; }
    .action-icon:hover { opacity: 0.7; }
</style>

{% endblock %}